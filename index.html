<!DOCTYPE html>
<html>
<head>
  <title>ğŸ Cricket Scorer</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 30px; }
    button { margin: 10px; padding: 15px 25px; font-size: 18px; }
    h1, h2 { margin-bottom: 0.2em; }
  </style>
</head>
<body>
  <h1>ğŸ Cricket Scorer</h1>
  <h2 id="score">Score: 0</h2>
  <h2 id="wickets">Wickets: 0/10</h2>
  <h2 id="overs">Overs: 0.0</h2>

  <div>
    <button id="run1">1 Run</button>
    <button id="run2">2 Runs</button>
    <button id="run3">3 Runs</button>
    <button id="run4">4 Runs</button>
    <button id="run6">6 Runs</button>
  </div>

  <div>
    <button id="noball">No Ball</button>
    <button id="wide">Wide</button>
    <button id="wicket">Wicket</button>
    <button id="undo">Undo</button>
    <button id="reset">Next Match</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBly7Pnw86MfsHWN4zgYVUzjvVC-TfJSZI",
      authDomain: "cricket-scorer-4fc6e.firebaseapp.com",
      databaseURL: "https://cricket-scorer-4fc6e-default-rtdb.firebaseio.com",
      projectId: "cricket-scorer-4fc6e",
      storageBucket: "cricket-scorer-4fc6e.firebasestorage.app",
      messagingSenderId: "1086801100988",
      appId: "1:1086801100988:web:0d961fb9749e57d48e50b9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const scoreRef = ref(db, "scoreData");

    let score = 0, wickets = 0, overs = 0, balls = 0;
    let history = [];

    function updateDisplay() {
      document.getElementById("score").textContent = `Score: ${score}`;
      document.getElementById("wickets").textContent = `Wickets: ${wickets}/10`;
      document.getElementById("overs").textContent = `Overs: ${overs}.${balls}`;
    }

    function saveState() {
      set(scoreRef, {
        score,
        wickets,
        overs,
        balls,
        history
      });
    }

    function addRun(runs) {
      score += runs;
      history.push({ action: 'run', value: runs });
      addBall();
      saveState();
    }

    function addWicket() {
      if (wickets >= 10) return;
      wickets++;
      history.push({ action: 'wicket' });
      addBall();
      saveState();
    }

    function addExtra(type) {
      score += 1;
      history.push({ action: type }); // 'noball' or 'wide'
      saveState();
    }

    function addBall() {
      balls++;
      if (balls === 6) {
        balls = 0;
        overs++;
      }
    }

    function removeBall() {
      if (balls === 0 && overs > 0) {
        overs--;
        balls = 5;
      } else if (balls > 0) {
        balls--;
      }
    }

    function undo() {
      if (history.length === 0) return;
      const last = history.pop();

      switch (last.action) {
        case 'run':
          score -= last.value;
          removeBall();
          break;
        case 'wicket':
          wickets--;
          removeBall();
          break;
        case 'noball':
        case 'wide':
          score -= 1;
          break;
      }

      saveState();
      updateDisplay();
    }

    function resetScore() {
      const confirmReset = confirm("Are you sure you want to start a new match?");
      if (!confirmReset) return;

      score = 0;
      wickets = 0;
      overs = 0;
      balls = 0;
      history = [];
      saveState();
      updateDisplay();
    }

    // Realtime listener from Firebase
    onValue(scoreRef, (snapshot) => {
      const data = snapshot.val();
      if (data) {
        score = data.score || 0;
        wickets = data.wickets || 0;
        overs = data.overs || 0;
        balls = data.balls || 0;
        history = data.history || [];
        updateDisplay();
      }
    });

    // Attach button events (ensures they work across devices/browsers)
    document.getElementById("run1").addEventListener("click", () => addRun(1));
    document.getElementById("run2").addEventListener("click", () => addRun(2));
    document.getElementById("run3").addEventListener("click", () => addRun(3));
    document.getElementById("run4").addEventListener("click", () => addRun(4));
    document.getElementById("run6").addEventListener("click", () => addRun(6));
    document.getElementById("noball").addEventListener("click", () => addExtra("noball"));
    document.getElementById("wide").addEventListener("click", () => addExtra("wide"));
    document.getElementById("wicket").addEventListener("click", () => addWicket());
    document.getElementById("undo").addEventListener("click", () => undo());
    document.getElementById("reset").addEventListener("click", () => resetScore());

    updateDisplay();
  </script>
</body>
</html>
